{"filter":false,"title":"reviews_controller.rb","tooltip":"/app/controllers/reviews_controller.rb","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":4,"column":2},"end":{"row":4,"column":4},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":2},"end":{"row":4,"column":3},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":3},"end":{"row":4,"column":4},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":4},"end":{"row":4,"column":5},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":5},"end":{"row":4,"column":6},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":6},"end":{"row":4,"column":7},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":7},"end":{"row":4,"column":8},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":8},"end":{"row":4,"column":9},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":3},"end":{"row":4,"column":9},"action":"remove","lines":["before"]},{"start":{"row":4,"column":3},"end":{"row":4,"column":16},"action":"insert","lines":["before_action"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":16},"end":{"row":4,"column":17},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":17},"end":{"row":4,"column":18},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":18},"end":{"row":4,"column":19},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":19},"end":{"row":4,"column":20},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":20},"end":{"row":4,"column":21},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":21},"end":{"row":4,"column":22},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":22},"end":{"row":4,"column":23},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":23},"end":{"row":4,"column":24},"action":"insert","lines":["k"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":24},"end":{"row":4,"column":25},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":25},"end":{"row":4,"column":26},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":26},"end":{"row":4,"column":27},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":27},"end":{"row":4,"column":28},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":28},"end":{"row":4,"column":29},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":28},"end":{"row":4,"column":29},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":27},"end":{"row":4,"column":28},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":26},"end":{"row":4,"column":27},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":25},"end":{"row":4,"column":26},"action":"remove","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":24},"end":{"row":4,"column":25},"action":"remove","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":23},"end":{"row":4,"column":24},"action":"remove","lines":["k"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":22},"end":{"row":4,"column":23},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":21},"end":{"row":4,"column":22},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":20},"end":{"row":4,"column":21},"action":"remove","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":19},"end":{"row":4,"column":20},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":18},"end":{"row":4,"column":19},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":17},"end":{"row":4,"column":18},"action":"remove","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":16},"end":{"row":4,"column":17},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":15},"end":{"row":4,"column":16},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":14},"end":{"row":4,"column":15},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":13},"end":{"row":4,"column":14},"action":"remove","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":12},"end":{"row":4,"column":13},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":11},"end":{"row":4,"column":12},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":10},"end":{"row":4,"column":11},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":9},"end":{"row":4,"column":10},"action":"remove","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":8},"end":{"row":4,"column":9},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":7},"end":{"row":4,"column":8},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":6},"end":{"row":4,"column":7},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":5},"end":{"row":4,"column":6},"action":"remove","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":4},"end":{"row":4,"column":5},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":3},"end":{"row":4,"column":4},"action":"remove","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":3},"end":{"row":4,"column":62},"action":"insert","lines":["before_action :check_user, only: [:edit, :update, :destroy]"]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":55},"end":{"row":45,"column":0},"action":"insert","lines":["",""]},{"start":{"row":45,"column":0},"end":{"row":45,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":2},"end":{"row":46,"column":0},"action":"insert","lines":["",""]},{"start":{"row":46,"column":0},"end":{"row":46,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":46,"column":0},"end":{"row":46,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":2},"end":{"row":46,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":0},"end":{"row":45,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":55},"end":{"row":45,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":3},"end":{"row":46,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":46,"column":0},"end":{"row":47,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":0},"end":{"row":51,"column":7},"action":"insert","lines":["def check_user","      unless @review.user == current_user","        redirect_to root_url, alert: \"Sorry, this review belongs to someone else\"","      end","    end"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":7},"end":{"row":52,"column":0},"action":"insert","lines":["",""]},{"start":{"row":52,"column":0},"end":{"row":52,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":41},"end":{"row":48,"column":42},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":42},"end":{"row":48,"column":43},"action":"insert","lines":["|"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":43},"end":{"row":48,"column":44},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":44},"end":{"row":48,"column":45},"action":"insert","lines":["|"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":45},"end":{"row":48,"column":46},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":46},"end":{"row":48,"column":48},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":47},"end":{"row":48,"column":48},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":48},"end":{"row":48,"column":49},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":49},"end":{"row":48,"column":50},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":50},"end":{"row":48,"column":51},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":51},"end":{"row":48,"column":52},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":52},"end":{"row":48,"column":53},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":53},"end":{"row":48,"column":54},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":54},"end":{"row":48,"column":55},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":55},"end":{"row":48,"column":56},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":56},"end":{"row":48,"column":57},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":57},"end":{"row":48,"column":58},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":58},"end":{"row":48,"column":59},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":59},"end":{"row":48,"column":60},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":60},"end":{"row":48,"column":61},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":61},"end":{"row":48,"column":62},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":62},"end":{"row":48,"column":63},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":63},"end":{"row":48,"column":64},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":64},"end":{"row":48,"column":65},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":65},"end":{"row":48,"column":66},"action":"insert","lines":["?"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":43},"end":{"row":48,"column":44},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":3},"end":{"row":4,"column":62},"action":"remove","lines":["before_action :check_user, only: [:edit, :update, :destroy]"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":3},"end":{"row":4,"column":62},"action":"insert","lines":["before_action :check_user, only: [:edit, :update, :destroy]"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":6},"end":{"row":51,"column":7},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":5},"end":{"row":51,"column":6},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":4},"end":{"row":51,"column":5},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":2},"end":{"row":51,"column":4},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":0},"end":{"row":51,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":50,"column":9},"end":{"row":51,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":0},"end":{"row":50,"column":9},"action":"remove","lines":["def check_user","      unless @review.user == current_user || (current_user.admin?)","        redirect_to root_url, alert: \"Sorry, this review belongs to someone else\"","      end"]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":0},"end":{"row":51,"column":7},"action":"insert","lines":[" def check_user","      unless @review.user == current_user","        redirect_to root_url, alert: \"Sorry, this review belongs to someone else\"","      end","    end"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":57,"column":0},"action":"remove","lines":["class ReviewsController < ApplicationController","   before_action :set_review, only: [:edit, :update, :destroy]","   before_action :set_restaurant","   before_action :authenticate_user!","   before_action :check_user, only: [:edit, :update, :destroy]","  respond_to :html","","  def new","    @review = Review.new","    respond_with(@review)","  end","","  def edit","  end","","  def create","    @review = Review.new(review_params)","     @review.user_id = current_user.id","     @review.restaurant_id = @restaurant.id","","      respond_to do |format|","      if @review.save","        format.html { redirect_to @restaurant, notice: 'Review was successfully created.' }","        format.json { render :show, status: :created, location: @review }","    end","  end","end","","  def update","    @review.update(review_params)","    respond_with(@review)","  end","","  def destroy","    @review.destroy","    respond_with(@review)","  end","","  private","    def set_review","      @review = Review.find(params[:id])","    end","","def set_restaurant","  @restaurant = Restaurant.find(params[:restaurant_id])","end",""," def check_user","      unless @review.user == current_user","        redirect_to root_url, alert: \"Sorry, this review belongs to someone else\"","      end","    end","    ","    def review_params","      params.require(:review).permit(:rating, :comment)","    end","end",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":94,"column":0},"action":"insert","lines":["Skip to content"," This repository","Pull requests","Issues","Gist"," @timetoshift"," Watch 1","  Star 0","  Fork 4","BaseRails/yelpdemo"," branch: master  yelpdemo/app/controllers/reviews_controller.rb","@alexyang21alexyang21 on Oct 12, 2014 Change redirect after reviews_update","1 contributor","RawBlameHistory     79 lines (68 sloc)  2.246 kb","class ReviewsController < ApplicationController","  before_action :set_review, only: [:edit, :update, :destroy]","  before_action :set_restaurant","  before_action :authenticate_user!","  before_action :check_user, only: [:edit, :update, :destroy]","","  # GET /reviews/new","  def new","    @review = Review.new","  end","","  # GET /reviews/1/edit","  def edit","  end","","  # POST /reviews","  # POST /reviews.json","  def create","    @review = Review.new(review_params)","    @review.user_id = current_user.id","    @review.restaurant_id = @restaurant.id","","    respond_to do |format|","      if @review.save","        format.html { redirect_to @restaurant, notice: 'Review was successfully created.' }","        format.json { render :show, status: :created, location: @review }","      else","        format.html { render :new }","        format.json { render json: @review.errors, status: :unprocessable_entity }","      end","    end","  end","","  # PATCH/PUT /reviews/1","  # PATCH/PUT /reviews/1.json","  def update","    respond_to do |format|","      if @review.update(review_params)","        format.html { redirect_to restaurant_path(@restaurant), notice: 'Review was successfully updated.' }","        format.json { render :show, status: :ok, location: @review }","      else","        format.html { render :edit }","        format.json { render json: @review.errors, status: :unprocessable_entity }","      end","    end","  end","","  # DELETE /reviews/1","  # DELETE /reviews/1.json","  def destroy","    @review.destroy","    respond_to do |format|","      format.html { redirect_to restaurant_path(@restaurant), notice: 'Review was successfully destroyed.' }","      format.json { head :no_content }","    end","  end","","  private","    # Use callbacks to share common setup or constraints between actions.","    def set_review","      @review = Review.find(params[:id])","    end","","    def set_restaurant","      @restaurant = Restaurant.find(params[:restaurant_id])","    end","","    def check_user","      unless (@review.user == current_user) || (current_user.admin?)","        redirect_to root_url, alert: \"Sorry, this review belongs to someone else\"","      end","    end","","    # Never trust parameters from the scary internet, only allow the white list through.","    def review_params","      params.require(:review).permit(:rating, :comment)","    end","end","Status API Training Shop Blog About","© 2015 GitHub, Inc. Terms Privacy Security Contact",""]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":13,"column":48},"action":"remove","lines":["Skip to content"," This repository","Pull requests","Issues","Gist"," @timetoshift"," Watch 1","  Star 0","  Fork 4","BaseRails/yelpdemo"," branch: master  yelpdemo/app/controllers/reviews_controller.rb","@alexyang21alexyang21 on Oct 12, 2014 Change redirect after reviews_update","1 contributor","RawBlameHistory     79 lines (68 sloc)  2.246 kb"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":78,"column":0},"end":{"row":79,"column":50},"action":"remove","lines":["Status API Training Shop Blog About","© 2015 GitHub, Inc. Terms Privacy Security Contact"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":3},"end":{"row":78,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":720,"scrollleft":0,"selection":{"start":{"row":77,"column":3},"end":{"row":77,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":50,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1429116000382,"hash":"0a07e37375a77a4178ff34c9eb935aa173ad6193"}